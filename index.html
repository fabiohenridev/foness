<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fones de Ouvido Gamer‚ÄØPro ‚Äì √Åudio de Elite</title>
    <script src="https://cdn.tailwindcss.com/3.4.3"></script>
    <style>
        body{background:#1f1f1f;color:#e5e5e5;font-family:'Inter',sans-serif;min-height:100vh;}
        .btn-red{background:#e63946;transform:translateY(0);transition:transform .2s,box-shadow .3s;box-shadow:0 4px 15px rgba(230,57,70,.4);}
        .btn-red:hover{background:#b91c1c;transform:translateY(-2px);box-shadow:0 6px 20px rgba(230,57,70,.6);}
        .section-title{position:relative;display:inline-block;margin-bottom:1.5rem;text-shadow:0 2px 4px rgba(0,0,0,.5);}
        .section-title::after{content:'';position:absolute;bottom:-8px;left:50%;transform:translateX(-50%);width:50%;height:3px;background:#e63946;}
        .carousel-img{transition:transform .3s,box-shadow .3s;}
        .carousel-img:hover{transform:scale(1.05);box-shadow:0 8px 20px rgba(230,57,70,.3);}
        .comment-card{display:flex;align-items:flex-start;transition:transform .2s,box-shadow .3s;background:#2a2a2a;padding:1.5rem;border-radius:8px;margin-bottom:1rem;}
        .comment-card:hover{transform:translateY(-4px);box-shadow:0 6px 15px rgba(230,57,70,.3);}
        .comment-avatar{width:48px;height:48px;border-radius:50%;margin-right:1rem;object-fit:cover;border:2px solid #e63946;}
        .comment-content{flex:1;}
        .comment-date{font-size:.875rem;color:#6b7280;}
        section,header,footer{position:relative;z-index:1;}
        section::before,header::before,footer::before,
        section::after,header::after,footer::after{content:'';position:absolute;left:0;right:0;height:20px;z-index:-1;}
        header::before{top:-20px;background:linear-gradient(to bottom,transparent,#1f1f1f);}
        header::after{bottom:-20px;background:linear-gradient(to bottom,#1f1f1f,#2a2a2a);}
        section:nth-of-type(1)::before{top:-20px;background:linear-gradient(to bottom,#2a2a2a,#1f1f1f);}
        section::after{bottom:-20px;background:linear-gradient(to bottom,#1f1f1f,#2a2a2a);}
        section:nth-of-type(2)::before,section:nth-of-type(3)::before{top:-20px;background:linear-gradient(to bottom,#2a2a2a,#1f1f1f);}
        section:nth-of-type(2)::after,section:nth-of-type(3)::after{bottom:-20px;background:linear-gradient(to bottom,#1f1f1f,#2a2a2a);}
        footer::before{top:-20px;background:linear-gradient(to bottom,#2a2a2a,#1f1f1f);}
        input,textarea{transition:box-shadow .3s,border-color .3s;}
        input:focus,textarea:focus{box-shadow:0 0 10px rgba(230,57,70,.4);border-color:#e63946;}
        .carousel-container{position:relative;width:100%;max-width:600px;margin:0 auto;overflow:hidden;border-radius:8px;}
        .carousel{display:flex;width:100%;transition:transform .5s ease-in-out;}
        .carousel-item{flex:0 0 100%;width:100%;}
        .carousel-btn{position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,.5);color:#e5e5e5;padding:.5rem 1rem;border:none;cursor:pointer;font-size:1.5rem;transition:background .3s;z-index:10;}
        .carousel-btn:hover{background:rgba(230,57,70,.7);}
        .prev-btn{left:10px}.next-btn{right:10px}
        .carousel-dots{position:absolute;bottom:15px;left:50%;transform:translateX(-50%);display:flex;gap:8px;}
        .carousel-dot{width:12px;height:12px;background:#2a2a2a;border-radius:50%;cursor:pointer;transition:background .3s;}
        .carousel-dot.active{background:#e63946;}
        #commentsList{display:flex;flex-direction:column;gap:1rem;}
        @media(min-width:768px){
            #commentsList{flex-direction:row;flex-wrap:wrap;justify-content:space-between;}
            .comment-card{flex:0 0 calc(50% - .5rem);}
        }
    </style>
    <link rel="icon" href="TEC.png" type="image/x-icon">
    <script>!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
    n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');fbq('init','3039782552846318');fbq('track','PageView');</script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=3039782552846318&ev=PageView&noscript=1"/></noscript>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body class="font-sans">
<header class="text-white py-6" style="background-color:#1f1f1f;">
    <div class="container mx-auto text-center">
        <h1 class="text-4xl md:text-5xl font-bold">Fone de Ouvido Gamer‚ÄØPro</h1>
        <p class="mt-3 text-lg md:text-xl text-gray-400">Entre no campo de batalha com √°udio de elite e conquiste a vit√≥ria que voc√™ merece.</p>
    </div>
</header>

<section class="py-16" style="background-color:#1f1f1f;">
<div class="container mx-auto px-4">
    <div class="flex flex-col md:flex-row items-center">
        <div class="md:w-1/2">
            <div class="carousel-container" role="region" aria-label="Carrossel de imagens do produto">
                <div class="carousel" id="carousel">
                    <div class="carousel-item"><img src="fone-venda.webp" alt="Imagem 1" class="carousel-img rounded-lg shadow-lg w-full" onerror="this.src='https://via.placeholder.com/600x400?text=Imagem+1'"></div>
                    <div class="carousel-item"><img src="fone-venda-2.webp" alt="Imagem 2" class="carousel-img rounded-lg shadow-lg w-full" onerror="this.src='https://via.placeholder.com/600x400?text=Imagem+2'"></div>
                    <div class="carousel-item"><img src="fone-venda-3.webp" alt="Imagem 3" class="carousel-img rounded-lg shadow-lg w-full" onerror="this.src='https://via.placeholder.com/600x400?text=Imagem+3'"></div>
                    <div class="carousel-item"><img src="fone-venda-4.webp" alt="Imagem 4" class="carousel-img rounded-lg shadow-lg w-full" onerror="this.src='https://via.placeholder.com/600x400?text=Imagem+4'"></div>
                    <div class="carousel-item"><img src="fone-venda-5.webp" alt="Imagem 5" class="carousel-img rounded-lg shadow-lg w-full" onerror="this.src='https://via.placeholder.com/600x400?text=Imagem+5'"></div>
                    <div class="carousel-item"><img src="fone-venda-6.webp" alt="Imagem 6" class="carousel-img rounded-lg shadow-lg w-full" onerror="this.src='https://via.placeholder.com/600x400?text=Imagem+6'"></div>
                    <div class="carousel-item"><img src="fone-venda-7.webp" alt="Imagem 7" class="carousel-img rounded-lg shadow-lg w-full" onerror="this.src='https://via.placeholder.com/600x400?text=Imagem+7'"></div>
                    <div class="carousel-item"><img src="fone-venda-8.webp" alt="Imagem 8" class="carousel-img rounded-lg shadow-lg w-full" onerror="this.src='https://via.placeholder.com/600x400?text=Imagem+8'"></div>
                    <div class="carousel-item"><img src="fone-venda-9.webp" alt="Imagem 8" class="carousel-img rounded-lg shadow-lg w-full" onerror="this.src='https://via.placeholder.com/600x400?text=Imagem+9'"></div>
                </div>
                <button class="carousel-btn prev-btn" aria-label="Imagem anterior">‚ùÆ</button>
                <button class="carousel-btn next-btn" aria-label="Pr√≥xima imagem">‚ùØ</button>
                <div class="carousel-dots" id="carousel-dots" role="tablist"></div>
            </div>
        </div>
        <div class="md:w-1/2 md:pl-8 mt-8 md:mt-0">
            <h2 class="text-3xl md:text-4xl font-bold text-white section-title">Imagine a cena decisiva‚Ä¶</h2>
            <p class="mt-4 text-gray-400">
                Voc√™ est√° em uma partida acirrada de Valorant, o placar est√° empatado, e o sil√™ncio do mapa √© cortado por passos furtivos √† sua direita. Com o <strong>Fone de Ouvido Gamer Pro</strong>, voc√™ n√£o apenas ouve o inimigo ‚Äì voc√™ sente a dire√ß√£o, a dist√¢ncia e at√© a inten√ß√£o. Em um piscar de olhos, voc√™ se posiciona, alinha o tiro e elimina o advers√°rio antes que ele perceba sua presen√ßa. Essa √© a vantagem que os grandes jogadores de Valorant, PUBG, CS, LoL e Dota j√° conhecem. E agora, ela est√° ao seu alcance por um pre√ßo que cabe no seu bolso.
            </p>
            <p class="mt-4 text-gray-400">
                Chega de ser aquele ‚Äúnoob‚Äù que perde por n√£o ouvir os detalhes. O <strong>Gamer Pro</strong> √© mais do que um fone ‚Äì √© o upgrade que seu setup merece. Utilizado por jogadores profissionais e entusiastas, este headset entrega qualidade de som surround est√©reo que transforma cada partida em uma experi√™ncia imersiva. Seus dois fones independentes permitem usar um ou ambos, e o microfone omnidirecional destac√°vel garante comunica√ß√£o cristalina com seu time, seja em estrat√©gias tensas ou bate-papos descontra√≠dos.
            </p>
            <h3 class="mt-6 text-2xl font-bold text-white">Por que o Gamer Pro √© imbat√≠vel:</h3>
            <ul class="mt-4 space-y-4 text-gray-300">
                <li><span class="font-bold text-red-500">üéß Som Surround Est√©reo:</span> √Åudio de alta fidelidade que revela cada detalhe ‚Äì dos passos mais sutis √†s explos√µes mais intensas ‚Äì para voc√™ dominar o campo de batalha.</li>
                <li><span class="font-bold text-red-500">üîá Microfone Profissional Destac√°vel:</span> Microfone omnidirecional de 41,5 mm com cancelamento de ru√≠do, perfeito para comandos claros e comunica√ß√£o sem interfer√™ncias.</li>
                <li><span class="font-bold text-red-500">üïπÔ∏è Conector P3 3,5 mm + USB:</span> Compatibilidade universal com PCs, notebooks, celulares (todas as marcas), PS4 e Xbox One, com um plugue em ‚ÄúL‚Äù que n√£o atrapalha seu controle.</li>
                <li><span class="font-bold text-red-500">üëÇ Conforto para maratonas:</span> Almofadas ergon√¥micas e design leve que garantem horas de jogo sem desconforto, mesmo nas sess√µes mais longas.</li>
                <li><span class="font-bold text-red-500">üéµ Versatilidade para m√∫sica:</span> Retire o microfone e transforme o Gamer Pro em um fone de ouvido premium para curtir suas m√∫sicas favoritas com qualidade excepcional.</li>
            </ul>
            <h3 class="mt-6 text-2xl font-bold text-white">Jogue como profissional, viva como campe√£o</h3>
            <p class="mt-4 text-gray-400">
                Como jogador, eu sei o que faz a diferen√ßa no calor da batalha. Quando testei o <strong>Gamer Pro</strong>, fiquei impressionado. O som √© t√£o claro que parece que voc√™ est√° dentro do jogo, e o microfone √© simplesmente o melhor que j√° usei ‚Äì comunica√ß√£o limpa, sem ru√≠dos, at√© nos momentos mais ca√≥ticos. Headsets de ponta costumam custar uma fortuna, mas o Gamer Pro entrega a mesma qualidade profissional por apenas <strong>R$ 59,99</strong>. √â o investimento que todo gamer merece para elevar seu desempenho e aproveitar o lazer ao m√°ximo.
            </p>
            <p class="mt-4 text-gray-400">
                N√£o importa se voc√™ joga no PC, console ou celular, ou se curte Valorant, CS, ou at√© uma playlist no Spotify ‚Äì o <strong>Gamer Pro</strong> √© seu parceiro ideal. Compat√≠vel com qualquer dispositivo, ele combina estilo, funcionalidade e durabilidade em um design que complementa seu setup gamer. Pare de jogar no escuro sonoro e d√™ o salto para o pr√≥ximo n√≠vel. Voc√™ merece ouvir cada detalhe, comandar com confian√ßa e viver cada partida como um verdadeiro pro.
            </p>
            <p class="mt-6 text-gray-400 font-bold">
                N√£o perca tempo! Clique em ‚ÄúComprar agora‚Äù e garanta seu <strong>Fone de Ouvido Gamer Pro</strong> hoje mesmo. Transforme suas partidas, sua m√∫sica e sua experi√™ncia em algo √©pico ‚Äì tudo isso por um pre√ßo que n√£o pesa no bolso!
            </p>
        </div>
    </div>
    <div class="mt-12 p-8 rounded-lg" style="background-color:#2a2a2a;">
        <h3 class="text-2xl md:text-3xl font-bold text-white section-title">Especifica√ß√µes que fazem a diferen√ßa</h3>
        <ul class="mt-6 text-gray-400 grid grid-cols-1 md:grid-cols-2 gap-4">
            <li><strong>Alto-falante:</strong> Som Est√©reo Surround</li>
            <li><strong>Frequ√™ncia:</strong> 20 Hz ‚Äì 20 kHz</li>
            <li><strong>Imped√¢ncia:</strong> 32 Œ© ¬± 15%</li>
            <li><strong>Sensibilidade:</strong> 52 dB ¬± 1,5 dB</li>
            <li><strong>Microfone:</strong> Omnidirecional 41,5 mm, destac√°vel</li>
            <li><strong>Cabo:</strong> 1,2 m, TPE flex√≠vel e resistente</li>
            <li><strong>Conex√£o:</strong> P3 3,5 mm + USB</li>
            <li><strong>Compatibilidade:</strong> PC, notebooks, celulares (todas as marcas), PS4, Xbox One</li>
            <li><strong>Itens inclusos:</strong> 1 Fone Gamer com microfone destac√°vel</li>
        </ul>
    </div>
    <div class="mt-6 text-center max-w-2xl mx-auto">
        <p class="text-3xl font-extrabold text-white bg-gradient-to-r from-red-600 to-red-800 p-4 rounded-lg shadow-lg hover:scale-[1.02] transition-transform duration-300" style="background-color: #e63946;">
            Por apenas <span class="text-4xl">R$ 59,99</span> transforme sua experi√™ncia de jogo HOJE!
        </p>
    </div>
    <div class="fixed bottom-0 left-0 w-full z-50">
        <button style="width: 100%;" onclick="trackPurchase()" class="bg-red-600 text-white px-8 py-4 text-center text-lg font-semibold shadow-lg block btn-red" aria-label="Comprar pelo WhatsApp">
            Comprar pelo WhatsApp
        </button>
    </div>
</div>
</section>

<section class="py-8" style="background-color:#1f1f1f;">
    <div class="container mx-auto text-center">
        <blockquote class="text-gray-200 italic text-lg max-w-2xl mx-auto">
            ‚ÄúOuvi o passo do advers√°rio antes dele virar a esquina. Essa fra√ß√£o de segundo valeu a vit√≥ria do time.‚Äù<br>
            <span class="font-bold text-white">‚Äì Thiago M., jogador competitivo</span>
        </blockquote>
    </div>
</section>

<section class="py-16" style="background-color:#1f1f1f;">
    <div class="container mx-auto px-4">
        <h2 class="text-3xl md:text-4xl font-bold text-center text-white section-title">O que os Gamers Est√£o Dizendo</h2>
        <div class="mt-10 grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="comment-card p-6 rounded-lg shadow-lg"><p class="text-gray-400">"O som √© t√£o claro que ouvi o inimigo antes de v√™-lo! Esses fones mudaram meu jogo."</p><p class="mt-4 font-bold text-white">- Jo√£o Silva</p></div>
            <div class="comment-card p-6 rounded-lg shadow-lg"><p class="text-gray-400">"Confort√°veis por horas e o microfone √© perfeito para estrat√©gias em equipe."</p><p class="mt-4 font-bold text-white">- Maria Oliveira</p></div>
            <div class="comment-card p-6 rounded-lg shadow-lg"><p class="text-gray-400">"Melhor custo-benef√≠cio que j√° vi. N√£o jogo mais sem eles!"</p><p class="mt-4 font-bold text-white">- Pedro Santos</p></div>
        </div>
    </div>
</section>

<section class="py-16" style="background-color:#1f1f1f;">
    <div class="container mx-auto px-4">
        <h2 class="text-3xl md:text-4xl font-bold text-center text-white section-title">Deixe Seu Coment√°rio</h2>
        <p class="mt-3 text-center text-gray-400">Compartilhe sua experi√™ncia com os Fones de Ouvido Gamer Pro!</p>
        <div class="mt-10 max-w-md mx-auto">
            <div id="registerFormContainer" class="space-y-4">
                <input type="text" id="registerUsername" placeholder="Seu Usu√°rio (3-20 caracteres)" class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-600 text-white" required>
                <input type="email" id="registerEmail" placeholder="Seu Email" class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-600 text-white" required>
                <button id="submitRegister" class="w-full btn-red text-white px-6 py-3 rounded-lg text-lg font-semibold" aria-label="Registrar Usu√°rio">Registrar</button>
                <p class="text-center text-gray-400">J√° tem um usu√°rio? <a href="#" id="showCommentForm" class="text-red-500 hover:underline">Comentar diretamente</a></p>
            </div>
            <form id="commentForm" class="space-y-4 hidden">
                <p class="text-gray-400">Comentando como: <span id="currentUsername" class="font-bold"></span> (<a href="#" id="logout" class="text-red-500 hover:underline">Sair</a>)</p>
                <input type="email" id="commentEmail" placeholder="Seu Email" class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-600 text-white" required>
                <textarea id="commentMessage" placeholder="Seu Coment√°rio" class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-600 text-white" rows="4" required></textarea>
                <button type="submit" id="submitComment" class="w-full btn-red text-white px-6 py-3 rounded-lg text-lg font-semibold" aria-label="Enviar Coment√°rio">Enviar Coment√°rio</button>
                <p class="text-center text-gray-400">N√£o tem um usu√°rio? <a href="#" id="showRegisterForm" class="text-red-500 hover:underline">Registrar</a></p>
            </form>
        </div>
        <h3 class="mt-16 text-2xl font-bold text-center text-white">Coment√°rios dos Usu√°rios</h3>
        <div id="connectionStatus" class="text-center text-gray-400" role="status"></div>
        <div id="commentsList" class="mt-8" role="list"></div>
    </div>
    <div class="fixed bottom-0 left-0 w-full z-50">
        <button style="width: 100%;" onclick="trackPurchase()" class="bg-red-600 text-white px-8 py-4 text-center text-lg font-semibold shadow-lg block btn-red" aria-label="Comprar pelo WhatsApp">
            Comprar pelo WhatsApp
        </button>
    </div>
</section>
<div class="fixed bottom-0 left-0 w-full z-50">
    <button style="width: 100%;" onclick="trackPurchase()" class="bg-red-600 text-white px-8 py-4 text-center text-lg font-semibold shadow-lg block btn-red" aria-label="Comprar pelo WhatsApp">
        Comprar pelo WhatsApp
    </button>
</div>

<footer class="text-white py-6" style="background-color:#1f1f1f;">
    <div class="container mx-auto text-center">
        <p>¬© 2025 Fones de Ouvido Gamer Pro. Todos os direitos reservados.</p>
        <p class="mt-2 text-sm text-gray-400">Envio em at√© 24 h em dias √∫teis | Suporte dedicado</p>
        <div class="mt-4">
            <button id="showVisitsBtn" class="text-gray-400 hover:text-white text-sm" aria-label="Mostrar total de visitas">
                <i class="fas fa-eye"></i>
            </button>
            <span id="visitCount" class="text-gray-400 ml-2" style="display: none;">Total de visitas: 0</span>
        </div>
    </div>
</footer>

<script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
<script>
const API_BASE_URL = 'https://backend-fone.onrender.com';
let socket = null;

function trackPurchase() {
    console.log('Tracking Purchase event');
    fbq('track', 'Purchase', {
        value: 59.99, // Valor do produto conforme especificado na p√°gina
        currency: 'BRL'
    });
    setTimeout(function() {
        console.log('Redirecting to WhatsApp');
        window.location.href = 'https://wa.me/5584991562754?text=ol%C3%A1,%20estou%20interessado%20pelo%20fone%20e%20gostaria%20de%20comprar%20!%F0%9F%98%83%F0%9F%98%83';
    }, 300); // Atraso de 300ms para garantir o envio do evento
}

function updateConnectionStatus(status, msg) {
    const el = document.getElementById('connectionStatus');
    if (!el) {
        console.warn('connectionStatus element not found');
        return;
    }
    if (status === 'connected') {
        el.textContent = '';
        el.className = 'text-center text-gray-400';
    } else {
        el.textContent = msg;
        el.className = `text-center ${status === 'disconnected' ? 'text-red-600' : 'text-yellow-600'}`;
    }
    console.log(`Connection status: ${status} - ${msg}`);
}

function initializeSocket() {
    try {
        socket = io(API_BASE_URL, {
            transports: ['websocket'],
            reconnection: true,
            reconnectionAttempts: 5,
            reconnectionDelay: 1000,
            reconnectionDelayMax: 5000,
            randomizationFactor: 0.5,
            timeout: 10000
        });
        socket.on('connect', () => {
            console.log('Socket connected');
            updateConnectionStatus('connected', '');
            loadComments();
        });
        socket.on('disconnect', () => {
            console.warn('Socket disconnected');
            updateConnectionStatus('disconnected', 'Conex√£o perdida. Tentando reconectar...');
        });
        socket.on('reconnect', () => {
            console.log('Socket reconnected');
            updateConnectionStatus('connected', '');
            loadComments();
        });
        socket.on('reconnect_attempt', () => {
            console.log('Socket reconnect attempt');
            updateConnectionStatus('reconnecting', 'Tentando reconectar...');
        });
        socket.on('reconnect_failed', () => {
            console.error('Socket reconnect failed');
            updateConnectionStatus('disconnected', 'N√£o foi poss√≠vel reconectar. Recarregue a p√°gina.');
        });
        socket.on('newComment', (comment) => {
            if (comment && comment.message && comment.createdAt) {
                console.log('New comment received:', comment);
                addCommentToDOM(comment);
            } else {
                console.warn('Invalid comment received:', comment);
            }
        });
        socket.on('connect_error', (err) => {
            console.error('Socket connection error:', err.message);
            updateConnectionStatus('disconnected', `Erro na conex√£o com o servidor: ${err.message}`);
        });
    } catch (e) {
        console.error('Socket initialization failed:', e);
        updateConnectionStatus('disconnected', 'Erro na inicializa√ß√£o da conex√£o.');
    }
}

const carousel = document.getElementById('carousel');
const items = document.querySelectorAll('.carousel-item');
const prevBtn = document.querySelector('.prev-btn');
const nextBtn = document.querySelector('.next-btn');
const dotsContainer = document.getElementById('carousel-dots');
let currentIndex = 0;

function createDots() {
    if (!dotsContainer) {
        console.warn('carousel-dots element not found');
        return;
    }
    dotsContainer.innerHTML = '';
    items.forEach((_, i) => {
        const dot = document.createElement('div');
        dot.classList.add('carousel-dot');
        dot.setAttribute('role', 'tab');
        dot.setAttribute('aria-selected', i === 0 ? 'true' : 'false');
        if (i === 0) dot.classList.add('active');
        dot.addEventListener('click', () => {
            console.log(`Navigating to slide ${i}`);
            goToSlide(i);
        });
        dotsContainer.appendChild(dot);
    });
}

function updateCarousel() {
    if (!carousel) {
        console.warn('carousel element not found');
        return;
    }
    carousel.style.transform = `translateX(-${currentIndex * 100}%)`;
    const dots = document.querySelectorAll('.carousel-dot');
    dots.forEach((dot, i) => {
        dot.classList.toggle('active', i === currentIndex);
        dot.setAttribute('aria-selected', i === currentIndex ? 'true' : 'false');
    });
    console.log(`Carousel updated to slide ${currentIndex}`);
}

function goToSlide(index) {
    currentIndex = index;
    if (currentIndex >= items.length) {
        currentIndex = 0;
    } else if (currentIndex < 0) {
        currentIndex = items.length - 1;
    }
    updateCarousel();
}

function initializeCarousel() {
    if (!carousel || !items.length || !prevBtn || !nextBtn || !dotsContainer) {
        console.warn('Carousel elements missing');
        return;
    }
    console.log('Initializing carousel');
    createDots();
    updateCarousel();
    prevBtn.removeEventListener('click', handlePrevClick);
    nextBtn.removeEventListener('click', handleNextClick);
    prevBtn.addEventListener('click', handlePrevClick);
    nextBtn.addEventListener('click', handleNextClick);
}

function handlePrevClick() {
    console.log('Previous slide');
    goToSlide(currentIndex - 1);
}

function handleNextClick() {
    console.log('Next slide');
    goToSlide(currentIndex + 1);
}

function escapeHTML(str) {
    if (!str) return '';
    return str.replace(/[&<>"']/g, char => ({
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#39;'
    }[char]));
}

function simpleHash(str) {
    let hash = 0;
    for (let i = 0; i < str.length; i++) {
        hash = ((hash << 5) - hash) + str.charCodeAt(i);
        hash = hash & hash;
    }
    return Math.abs(hash);
}

const avatarColors = [
    'E63946', '457B9D', '2A9D8F', 'F4A261', '9B59B6', 'E76F51',
    '2196F3', '4CAF50', 'FF9800', '6D4C41', '00BCD4', 'F06292'
];

function getAvatarUrl(username, email) {
    const seed = encodeURIComponent(username || 'unknown');
    const hashInput = (username || '') + (email || '');
    const colorIndex = hashInput ? simpleHash(hashInput) % avatarColors.length : 0;
    const color = avatarColors[colorIndex];
    return `https://api.dicebear.com/9.x/initials/svg?seed=${seed}&backgroundColor=${color}&fontSize=40`;
}

function showRegisterForm() {
    const registerForm = document.getElementById('registerFormContainer');
    const commentForm = document.getElementById('commentForm');
    if (!registerForm || !commentForm) {
        console.warn('Register or comment form not found');
        return;
    }
    registerForm.classList.remove('hidden');
    commentForm.classList.add('hidden');
    console.log('Showing register form');
}

function showCommentForm() {
    let user = null;
    try {
        const userData = localStorage.getItem('user');
        if (userData) user = JSON.parse(userData);
    } catch (e) {
        console.error('Failed to parse user from localStorage:', e);
        user = null;
    }
    const currentUsername = document.getElementById('currentUsername');
    const registerForm = document.getElementById('registerFormContainer');
    const commentForm = document.getElementById('commentForm');
    if (!currentUsername || !registerForm || !commentForm) {
        console.warn('Form elements missing in showCommentForm');
        return;
    }
    if (user && user.id && user.username) {
        currentUsername.textContent = user.username;
        registerForm.classList.add('hidden');
        commentForm.classList.remove('hidden');
        console.log(`Showing comment form for user: ${user.username}`);
    } else {
        showRegisterForm();
        console.log('No user found, showing register form');
    }
}

function logout() {
    try {
        localStorage.removeItem('user');
        showRegisterForm();
        console.log('User logged out');
    } catch (e) {
        console.error('Logout failed:', e);
        alert('Erro ao fazer logout. Tente novamente.');
    }
}

function addCommentToDOM(comment) {
    const list = document.getElementById('commentsList');
    if (!list) {
        console.warn('commentsList element not found');
        return;
    }
    const empty = list.querySelector('p.text-gray-400.text-center');
    if (empty) list.innerHTML = '';
    if (!comment || !comment.message || !comment.createdAt) {
        console.warn('Invalid comment data:', comment);
        return;
    }
    const card = document.createElement('div');
    card.className = 'comment-card';
    card.setAttribute('role', 'listitem');
    const username = comment.userId?.username || comment.name || 'An√¥nimo';
    const email = comment.userId?.email || comment.email || '';
    const createdAt = comment.createdAt ? new Date(comment.createdAt).toLocaleDateString('pt-BR') : 'Data desconhecida';
    card.innerHTML = `
        <img src="${getAvatarUrl(username, email)}" alt="Avatar de ${escapeHTML(username)}" class="comment-avatar">
        <div class="comment-content">
            <p class="text-gray-400">${escapeHTML(comment.message)}</p>
            <p class="mt-2 font-bold text-white">- ${escapeHTML(username)}</p>
            <p class="comment-date">${createdAt}</p>
        </div>`;
    list.prepend(card);
    console.log(`Added comment by ${username}`);
}

async function loadComments(attempt = 1) {
    const list = document.getElementById('commentsList');
    if (!list) {
        console.warn('commentsList element not found');
        return;
    }
    list.innerHTML = '<p class="text-gray-400 text-center">Carregando coment√°rios...</p>';
    try {
        const response = await fetch(`${API_BASE_URL}/api/comments`, {
            method: 'GET',
            headers: { 'Accept': 'application/json' },
            timeout: 10000
        });
        if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            throw new Error(errorData.error || errorData.details || `Erro HTTP: ${response.status}`);
        }
        const comments = await response.json();
        list.innerHTML = '';
        if (!Array.isArray(comments) || comments.length === 0) {
            list.innerHTML = '<p class="text-gray-400 text-center">Nenhum coment√°rio ainda. Seja o primeiro!</p>';
            console.log('No comments found');
            return;
        }
        comments.reverse().forEach(comment => {
            if (comment && comment.message && comment.createdAt) {
                addCommentToDOM(comment);
            } else {
                console.warn('Skipping invalid comment:', comment);
            }
        });
        console.log(`Loaded ${comments.length} comments`);
    } catch (err) {
        console.error(`Attempt ${attempt} failed to load comments:`, err);
        if (attempt < 3) {
            console.log(`Retrying loadComments, attempt ${attempt + 1}`);
            setTimeout(() => loadComments(attempt + 1), attempt * 2000);
        } else {
            list.innerHTML = `<p class="text-red-600 text-center">Erro ao carregar coment√°rios: ${escapeHTML(err.message)}. Tente recarregar a p√°gina.</p>`;
            console.error('Failed to load comments after 3 attempts');
        }
    }
}

function initializeEventListeners() {
    const showRegisterLink = document.getElementById('showRegisterForm');
    const showCommentLink = document.getElementById('showCommentForm');
    const logoutLink = document.getElementById('logout');
    const submitRegisterBtn = document.getElementById('submitRegister');
    const commentForm = document.getElementById('commentForm');

    if (showRegisterLink) {
        showRegisterLink.addEventListener('click', (e) => {
            e.preventDefault();
            showRegisterForm();
            console.log('Clicked show register form link');
        });
    }

    if (showCommentLink) {
        showCommentLink.addEventListener('click', (e) => {
            e.preventDefault();
            showCommentForm();
            console.log('Clicked show comment form link');
        });
    }

    if (logoutLink) {
        logoutLink.addEventListener('click', (e) => {
            e.preventDefault();
            logout();
            console.log('Clicked logout link');
        });
    }

    if (submitRegisterBtn) {
        submitRegisterBtn.addEventListener('click', async (e) => {
            e.preventDefault();
            const usernameInput = document.getElementById('registerUsername');
            const emailInput = document.getElementById('registerEmail');
            if (!usernameInput || !emailInput) {
                console.warn('Register form inputs missing');
                alert('Formul√°rio incompleto.');
                return;
            }
            const username = usernameInput.value.trim();
            const email = emailInput.value.trim();
            if (!username || !email) {
                alert('Preencha usu√°rio e email.');
                console.log('Empty username or email');
                return;
            }
            if (!/^[a-zA-Z0-9_]{3,20}$/.test(username)) {
                alert('Usu√°rio deve ter 3-20 caracteres e conter apenas letras, n√∫meros ou sublinhados.');
                console.log('Invalid username format');
                return;
            }
            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                alert('Email inv√°lido.');
                console.log('Invalid email format');
                return;
            }
            try {
                console.log(`Registering user: ${username}, ${email}`);
                const response = await fetch(`${API_BASE_URL}/api/users/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, email })
                });
                const data = await response.json();
                if (!response.ok) {
                    throw new Error(data.error || 'Erro ao registrar');
                }
                localStorage.setItem('user', JSON.stringify({ id: data.user.id, username: data.user.username }));
                alert('Usu√°rio registrado com sucesso!');
                showCommentForm();
                console.log('User registered successfully');
            } catch (err) {
                console.error('Register failed:', err);
                alert(`Erro: ${err.message}`);
            }
        });
    }

    if (commentForm) {
        commentForm.removeEventListener('submit', handleCommentSubmit);
        commentForm.addEventListener('submit', handleCommentSubmit);
    }
}

function handleCommentSubmit(e) {
    e.preventDefault();
    const commentForm = document.getElementById('commentForm');
    let user = null;
    try {
        const userData = localStorage.getItem('user');
        if (userData) user = JSON.parse(userData);
    } catch (err) {
        console.error('Failed to parse user from localStorage:', err);
        user = null;
    }
    if (!user || !user.id) {
        showRegisterForm();
        alert('Por favor, registre um usu√°rio primeiro.');
        console.log('No user found for comment submission');
        return;
    }
    const emailInput = document.getElementById('commentEmail');
    const messageInput = document.getElementById('commentMessage');
    if (!emailInput || !messageInput) {
        console.warn('Comment form inputs missing');
        alert('Formul√°rio incompleto.');
        return;
    }
    const email = emailInput.value.trim();
    const message = messageInput.value.trim();
    if (!email || !message) {
        alert('Preencha email e mensagem.');
        console.log('Empty email or message');
        return;
    }
    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        alert('Email inv√°lido.');
        console.log('Invalid email format');
        return;
    }
    const submitButton = document.getElementById('submitComment');
    submitButton.disabled = true;
    fetch(`${API_BASE_URL}/api/comments`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ userId: user.id, message })
    })
        .then(response => response.json())
        .then(data => {
            if (!response.ok) {
                throw new Error(data.error || 'Erro ao enviar coment√°rio');
            }
            alert('Coment√°rio enviado!');
            commentForm.reset();
            submitButton.disabled = false;
            console.log('Comment submitted successfully');
        })
        .catch(err => {
            console.error('Comment submission failed:', err);
            alert(`Erro: ${err.message}`);
            submitButton.disabled = false;
        });
}

function initializePing() {
    setInterval(async () => {
        try {
            const response = await fetch(`${API_BASE_URL}/ping`);
            if (!response.ok) {
                console.warn('Ping failed:', response.status);
            } else {
                console.log('Ping successful');
            }
        } catch (e) {
            console.error('Ping error:', e);
        }
    }, 300000);
}

async function fetchVisitCount() {
    try {
        const response = await fetch(`${API_BASE_URL}/api/visits/count`);
        if (!response.ok) {
            throw new Error('Erro ao buscar total de visitas');
        }
        const data = await response.json();
        return data.totalVisits;
    } catch (error) {
        console.error('Erro ao buscar total de visitas:', error);
        return 0;
    }
}

function toggleVisitCount() {
    const visitCountElement = document.getElementById('visitCount');
    const showVisitsBtn = document.getElementById('showVisitsBtn');
    if (visitCountElement.style.display === 'none') {
        fetchVisitCount().then(count => {
            visitCountElement.textContent = `Total de visitas: ${count}`;
            visitCountElement.style.display = 'inline';
            showVisitsBtn.innerHTML = '<i class="fas fa-eye-slash"></i>';
        });
    } else {
        visitCountElement.style.display = 'none';
        showVisitsBtn.innerHTML = '<i class="fas fa-eye"></i>';
    }
}

document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM loaded, initializing components');
    try {
        console.log('Tailwind CSS loaded');
        initializeSocket();
        initializeCarousel();
        initializeEventListeners();
        initializePing();
        showCommentForm();
        loadComments();
        document.getElementById('showVisitsBtn').addEventListener('click', toggleVisitCount);
        async function registerVisit() {
            try {
                await fetch(`${API_BASE_URL}/api/visits`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                });
                console.log('Visita registrada');
            } catch (error) {
                console.error('Erro ao registrar visita:', error);
            }
        }
        registerVisit();
    } catch (e) {
        console.error('Initialization failed:', e);
        alert('Erro ao inicializar a p√°gina. Recarregue e tente novamente.');
    }
});
</script>
</body>
</html>